# Функционал мессенджера

## Общие функции

- Отдельный чат с тех поддержкой
    >Формируется автоматически для каждого пользователя после регистрации
- Отдельный чат с уведомлениями о новых/отмененных/подтвержденных записях созданных через бота
- Отдельный чат с уведомлениями о новых записях созданных через онлайн-запись
- Отслеживание непрочитанных сообщений
- Отправление пуша сотруднику при поступлении нового сообщения
- Получение списка чатов при установке WebSocket соединения
- Хранение токена бота тех поддержки
    >dev: "6326079925:AAFbnXcr-zx5Is_lzhg8dK02hMp1PdwFxY4"
    >prod: "6948200427:AAE70sYf3SZTFkAikD2wv5ZsIZojv8cfCR8"

---

## Чаты

Функции

- Получение списка чатов
    Ответ:

    ```json
    {
        "type":"chat_list",
        "data":[
            {
                "chat_id":"",
                "chat_name":"",
                "users":[
                    {
                        "user_id":""
                    },
                    {
                        "user_id":""
                    },
                    ...
                ],
                "IsGroupChat":false,
                "lastest_message":"", // текст последнего сообщения
                "group_admin":"", // user_id администратора группового чата
                "is_tech_support":false, // является ли чат чатом с тех поддержкой
                "is_telegram_chat":false, // является ли чат чатом с уведомлениями от бота
                "unread":0, // количество непрочитанных сообщений
                "created_at":"", // временная метка создания чата
                "updated_at":"" // временнная метка обновления чата (например переименование)
            },
            ...
        ]
    }
    ```

- Создание чата двух человек
    Запрос:

    ```json
    {
        "type":"create_chat",
        "data":{
            "created_by_user_id":"",
            "with_user_id":[
                {
                    "user_id":""
                }
            ],
            "chat_name":""
        }
    }
    ```

    Ответ:

    ```json
    {
        "type":"chat_list",
        "data":[
            {
                "chat_id":"",
                "chat_name":"",
                "users":[
                    {
                        "user_id":""
                    },
                    {
                        "user_id":""
                    },
                    ...
                ],
                "IsGroupChat":false,
                "lastest_message":"", // текст последнего сообщения
                "group_admin":"", // user_id администратора группового чата
                "is_tech_support":false, // является ли чат чатом с тех поддержкой
                "is_telegram_chat":false, // является ли чат чатом с уведомлениями от бота
                "unread":0, // количество непрочитанных сообщений
                "created_at":"", // временная метка создания чата
                "updated_at":"" // временнная метка обновления чата (например переименование)
            },
            ...
        ]
    }
    ```

- Создание группового чата

    ```json
    {
        "type":"create_chat",
        "data":{
            "created_by_user_id":"",
            "with_user_id":[
                {
                    "user_id":""
                },
                {
                    "user_id":""
                },
                ...
            ],
            "chat_name":""
        }
    }
    ```

    Ответ:

    ```json
    {
        "type":"chat_list",
        "data":[
            {
                "chat_id":"",
                "chat_name":"",
                "users":[
                    {
                        "user_id":""
                    },
                    {
                        "user_id":""
                    },
                    {
                        "user_id":""
                    },
                    ...
                ],
                "IsGroupChat":false,
                "lastest_message":"", // текст последнего сообщения
                "group_admin":"", // user_id администратора группового чата
                "is_tech_support":false, // является ли чат чатом с тех поддержкой
                "is_telegram_chat":false, // является ли чат чатом с уведомлениями от бота
                "unread":0, // количество непрочитанных сообщений
                "created_at":"", // временная метка создания чата
                "updated_at":"" // временнная метка обновления чата (например переименование)
            },
            ...
        ]
    }
    ```

- Добавление пользователя в групповой чат
    Не реализовано
- Удаление чата
    Запрос:

    ```json
    {
        "type":"delete_chat",
        "data":{
            "chat_id":""
        }
    }
    ```

    Ответ:

    ```json
    {
        "type":"chat_list",
        "data":[
            {
                "chat_id":"",
                "chat_name":"",
                "users":[
                    {
                        "user_id":""
                    },
                    {
                        "user_id":""
                    },
                    ...
                ],
                "IsGroupChat":false,
                "lastest_message":"", // текст последнего сообщения
                "group_admin":"", // user_id администратора группового чата
                "is_tech_support":false, // является ли чат чатом с тех поддержкой
                "is_telegram_chat":false, // является ли чат чатом с уведомлениями от бота
                "unread":0, // количество непрочитанных сообщений
                "created_at":"", // временная метка создания чата
                "updated_at":"" // временнная метка обновления чата (например переименование)
            },
            ...
        ]
    }
    ```

- Переименование чата
    Запрос:

    ```json
    {
        "type":"rename_chat",
        "data":{
            "chat_id":"",
            "new_name":""
        }
    }
    ```

    Ответ:

    ```json
    {
        "type":"chat_list",
        "data":[
            {
                "chat_id":"",
                "chat_name":"",
                "users":[
                    {
                        "user_id":""
                    },
                    {
                        "user_id":""
                    },
                    ...
                ],
                "IsGroupChat":false,
                "lastest_message":"", // текст последнего сообщения
                "group_admin":"", // user_id администратора группового чата
                "is_tech_support":false, // является ли чат чатом с тех поддержкой
                "is_telegram_chat":false, // является ли чат чатом с уведомлениями от бота
                "unread":0, // количество непрочитанных сообщений
                "created_at":"", // временная метка создания чата
                "updated_at":"" // временнная метка обновления чата (например переименование)
            },
            ...
        ]
    }
    ```

---

## Сообщения

Функции

- Получение списка сообщений для конкретного чата
    Запрос:

    ```json
    {
        "type":"get_chat_messages",
        "data":{
            "chat_id":""
        }
    }
    ```

    Ответ:

    ```json
    {
        "type":"chat_messages",
        "data":[
            {
                "id":"",
                "sender":"", // user_id отправителя
                "content":"", // текст сообщения
                "chat":{
                    "chat_id":"",
                    "chat_name":"",
                    "users":[
                        {
                            "user_id":""
                        },
                        {
                            "user_id":""
                        },
                        ...
                    ],
                    "IsGroupChat":false,
                    "lastest_message":"", // текст последнего сообщения
                    "group_admin":"", // user_id администратора группового чата
                    "is_tech_support":false, // является ли чат чатом с тех поддержкой
                    "is_telegram_chat":false, // является ли чат чатом с уведомлениями от бота
                    "unread":0, // количество непрочитанных сообщений
                    "created_at":"", // временная метка создания чата
                    "updated_at":"" // временнная метка обновления чата (например переименование)
                },
                "is_read":true, // прочитано ли сообщение,
                "created_at":"", // временная метка создания сообщения
                "updated_at":"" // временнная метка обновления сообщения
            }
        ]
    }
    ```

    ```json
    {
        "type":"chat_list",
        "data":[
            {
                "chat_id":"",
                "chat_name":"",
                "users":[
                    {
                        "user_id":""
                    },
                    {
                        "user_id":""
                    },
                    ...
                ],
                "IsGroupChat":false,
                "lastest_message":"", // текст последнего сообщения
                "group_admin":"", // user_id администратора группового чата
                "is_tech_support":false, // является ли чат чатом с тех поддержкой
                "is_telegram_chat":false, // является ли чат чатом с уведомлениями от бота
                "unread":0, // количество непрочитанных сообщений
                "created_at":"", // временная метка создания чата
                "updated_at":"" // временнная метка обновления чата (например переименование)
            },
            ...
        ]
    }
    ```

- Отправка текстового сообщения
    Запрос:

    ```json
    {
        "type":"send_message",
        "data":{
            "chat_id":"",
            "sender_id":"", // user_id отправителя
            "content":"", // текст сообщения
            "sender_fio":"" // ФИО отправителя (нужно для отправки уведомленния в чат с техподдержкой)
        }
    }
    ```

    Ответ:

    ```json
    {
        "type":"chat_list",
        "data":[
            {
                "chat_id":"",
                "chat_name":"",
                "users":[
                    {
                        "user_id":""
                    },
                    {
                        "user_id":""
                    },
                    ...
                ],
                "IsGroupChat":false,
                "lastest_message":"", // текст последнего сообщения
                "group_admin":"", // user_id администратора группового чата
                "is_tech_support":false, // является ли чат чатом с тех поддержкой
                "is_telegram_chat":false, // является ли чат чатом с уведомлениями от бота
                "unread":0, // количество непрочитанных сообщений
                "created_at":"", // временная метка создания чата
                "updated_at":"" // временнная метка обновления чата (например переименование)
            },
            ...
        ]
    }
    ```

    ```json
    {
        "type":"chat_messages",
        "data":[
            {
                "id":"",
                "sender":"", // user_id отправителя
                "content":"", // текст сообщения
                "chat":{
                    "chat_id":"",
                    "chat_name":"",
                    "users":[
                        {
                            "user_id":""
                        },
                        {
                            "user_id":""
                        },
                        ...
                    ],
                    "IsGroupChat":false,
                    "lastest_message":"", // текст последнего сообщения
                    "group_admin":"", // user_id администратора группового чата
                    "is_tech_support":false, // является ли чат чатом с тех поддержкой
                    "is_telegram_chat":false, // является ли чат чатом с уведомлениями от бота
                    "unread":0, // количество непрочитанных сообщений
                    "created_at":"", // временная метка создания чата
                    "updated_at":"" // временнная метка обновления чата (например переименование)
                },
                "is_read":true, // прочитано ли сообщение,
                "created_at":"", // временная метка создания сообщения
                "updated_at":"" // временнная метка обновления сообщения
            }
        ]
    }
    ```

- Отправка сообщения с картинкой
    Не реализовано
- Редактирование сообщения
    Не реализовано
